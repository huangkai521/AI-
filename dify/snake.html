<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ªåƒè›‡æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            overflow: hidden;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .score-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-label {
            font-size: 14px;
            margin-bottom: 5px;
            color: #ccc;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #4ecca3;
        }

        .game-board {
            position: relative;
            width: 400px;
            height: 400px;
            background-color: #232931;
            border: 2px solid #4ecca3;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(78, 204, 163, 0.3);
            overflow: hidden;
        }

        .grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .snake {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #4ecca3;
            border-radius: 4px;
            transition: all 0.1s ease;
            z-index: 10;
        }

        .snake-head {
            background-color: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
            z-index: 20;
        }

        .food {
            position: absolute;
            width: 18px;
            height: 18px;
            background-color: #e74c3c;
            border-radius: 50%;
            animation: pulse 1s infinite alternate;
            z-index: 15;
        }

        @keyframes pulse {
            from {
                transform: scale(0.9);
                box-shadow: 0 0 5px #e74c3c;
            }
            to {
                transform: scale(1.1);
                box-shadow: 0 0 15px #e74c3c;
            }
        }

        .controls {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
        }

        button {
            padding: 12px 25px;
            background: #4ecca3;
            color: #232931;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 #3aa88a;
        }

        button:hover {
            background: #3aa88a;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #2e8c6e;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        button:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 5px;
        }

        .overlay-content {
            text-align: center;
            padding: 30px;
            background: rgba(35, 41, 49, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(78, 204, 163, 0.5);
        }

        .overlay-title {
            font-size: 32px;
            margin-bottom: 20px;
            color: #4ecca3;
        }

        .overlay-message {
            font-size: 18px;
            margin-bottom: 25px;
        }

        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 200px;
            height: 200px;
            margin-top: 20px;
        }

        .mobile-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 24px;
            user-select: none;
        }

        .mobile-btn.up { grid-column: 2; grid-row: 1; }
        .mobile-btn.down { grid-column: 2; grid-row: 3; }
        .mobile-btn.left { grid-column: 1; grid-row: 2; }
        .mobile-btn.right { grid-column: 3; grid-row: 2; }

        .settings {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .sound-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .sound-icon {
            font-size: 20px;
        }

        @media (max-width: 500px) {
            .game-board {
                width: 350px;
                height: 350px;
            }
            
            .mobile-controls {
                display: grid;
            }
        }

        @media (max-width: 400px) {
            .game-board {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="score-container">
                <div class="score-label">å½“å‰å¾—åˆ†</div>
                <div id="score" class="score-value">0</div>
            </div>
            <div class="score-container">
                <div class="score-label">æœ€é«˜åˆ†</div>
                <div id="high-score" class="score-value">0</div>
            </div>
        </div>

        <div class="game-board">
            <div class="grid"></div>
            <!-- è›‡å’Œé£Ÿç‰©å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="controls">
            <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
            <button id="pause-btn" disabled>æš‚åœ</button>
            <button id="restart-btn">é‡æ–°å¼€å§‹</button>
        </div>

        <div class="mobile-controls">
            <div class="mobile-btn up">â†‘</div>
            <div class="mobile-btn down">â†“</div>
            <div class="mobile-btn left">â†</div>
            <div class="mobile-btn right">â†’</div>
        </div>

        <div class="settings">
            <div class="sound-toggle" id="sound-toggle">
                <span class="sound-icon">ğŸ”Š</span>
                <span>éŸ³æ•ˆ</span>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const config = {
            gridSize: 20,           // ç½‘æ ¼å°ºå¯¸
            cellSize: 20,           // æ¯ä¸ªæ ¼å­çš„å¤§å°(åƒç´ )
            gameSpeed: 150,         // æ¸¸æˆé€Ÿåº¦(æ¯«ç§’)
            initialSnakeLength: 3,  // åˆå§‹è›‡é•¿åº¦
            foodPoints: 10          // æ¯ä¸ªé£Ÿç‰©çš„å¾—åˆ†
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            READY: 'ready',
            PLAYING: 'playing',
            PAUSED: 'paused',
            GAME_OVER: 'game_over'
        };

        // æ–¹å‘å¸¸é‡
        const directions = {
            UP: { x: 0, y: -1 },
            DOWN: { x: 0, y: 1 },
            LEFT: { x: -1, y: 0 },
            RIGHT: { x: 1, y: 0 }
        };

        // æ¸¸æˆå˜é‡
        let currentState = gameState.READY;
        let snake = [];
        let food = { x: 0, y: 0 };
        let currentDirection = directions.RIGHT;
        let nextDirection = directions.RIGHT;
        let score = 0;
        let highScore = 0;
        let gameInterval = null;
        let soundEnabled = true;

        // DOMå…ƒç´ 
        const gameBoard = document.querySelector('.game-board');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('high-score');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const restartBtn = document.getElementById('restart-btn');
        const soundToggle = document.getElementById('sound-toggle');
        const mobileControls = document.querySelectorAll('.mobile-btn');

        // éŸ³æ•ˆ
        const sounds = {
            eat: new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=='),
            crash: new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==')
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æœ€é«˜åˆ†å’ŒéŸ³æ•ˆè®¾ç½®
            loadSettings();
            
            // åˆå§‹åŒ–è›‡
            initSnake();
            
            // ç”Ÿæˆç¬¬ä¸€ä¸ªé£Ÿç‰©
            generateFood();
            
            // æ›´æ–°UI
            updateUI();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('snakeGameSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                highScore = settings.highScore || 0;
                soundEnabled = settings.soundEnabled !== false;
                updateSoundToggle();
            }
            highScoreElement.textContent = highScore;
        }

        // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
        function saveSettings() {
            const settings = {
                highScore: highScore,
                soundEnabled: soundEnabled
            };
            localStorage.setItem('snakeGameSettings', JSON.stringify(settings));
        }

        // åˆå§‹åŒ–è›‡
        function initSnake() {
            snake = [];
            // è›‡åˆå§‹ä½ç½®åœ¨æ¸¸æˆåŒºåŸŸä¸­å¤®
            const startX = Math.floor(config.gridSize / 2);
            const startY = Math.floor(config.gridSize / 2);
            
            for (let i = 0; i < config.initialSnakeLength; i++) {
                snake.push({
                    x: startX - i,
                    y: startY
                });
            }
            
            currentDirection = directions.RIGHT;
            nextDirection = directions.RIGHT;
        }

        // ç”Ÿæˆé£Ÿç‰©
        function generateFood() {
            let newFood;
            let isOnSnake;
            
            do {
                newFood = {
                    x: Math.floor(Math.random() * config.gridSize),
                    y: Math.floor(Math.random() * config.gridSize)
                };
                
                // æ£€æŸ¥é£Ÿç‰©æ˜¯å¦åœ¨è›‡èº«ä¸Š
                isOnSnake = snake.some(segment => 
                    segment.x === newFood.x && segment.y === newFood.y
                );
            } while (isOnSnake);
            
            food = newFood;
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
            gameBoard.innerHTML = '<div class="grid"></div>';
            
            // ç»˜åˆ¶è›‡
            snake.forEach((segment, index) => {
                const snakeElement = document.createElement('div');
                snakeElement.className = 'snake' + (index === 0 ? ' snake-head' : '');
                snakeElement.style.left = segment.x * config.cellSize + 'px';
                snakeElement.style.top = segment.y * config.cellSize + 'px';
                gameBoard.appendChild(snakeElement);
            });
            
            // ç»˜åˆ¶é£Ÿç‰©
            const foodElement = document.createElement('div');
            foodElement.className = 'food';
            foodElement.style.left = food.x * config.cellSize + 'px';
            foodElement.style.top = food.y * config.cellSize + 'px';
            gameBoard.appendChild(foodElement);
            
            // æ›´æ–°åˆ†æ•°
            scoreElement.textContent = score;
            highScoreElement.textContent = highScore;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonStates();
            
            // æ˜¾ç¤º/éšè—æ¸¸æˆç»“æŸè¦†ç›–å±‚
            showGameOverlay();
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStates() {
            startBtn.disabled = currentState === gameState.PLAYING || currentState === gameState.PAUSED;
            pauseBtn.disabled = currentState !== gameState.PLAYING;
            
            if (currentState === gameState.PLAYING) {
                pauseBtn.textContent = 'æš‚åœ';
            } else if (currentState === gameState.PAUSED) {
                pauseBtn.textContent = 'ç»§ç»­';
            }
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æŸè¦†ç›–å±‚
        function showGameOverlay() {
            // ç§»é™¤ç°æœ‰çš„è¦†ç›–å±‚
            const existingOverlay = document.querySelector('.game-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // å¦‚æœä¸æ˜¯æ¸¸æˆç»“æŸçŠ¶æ€ï¼Œä¸æ˜¾ç¤ºè¦†ç›–å±‚
            if (currentState !== gameState.GAME_OVER) return;
            
            // åˆ›å»ºè¦†ç›–å±‚
            const overlay = document.createElement('div');
            overlay.className = 'game-overlay';
            
            const content = document.createElement('div');
            content.className = 'overlay-content';
            
            const title = document.createElement('div');
            title.className = 'overlay-title';
            title.textContent = 'æ¸¸æˆç»“æŸ';
            
            const message = document.createElement('div');
            message.className = 'overlay-message';
            message.textContent = `æœ€ç»ˆå¾—åˆ†: ${score}`;
            
            content.appendChild(title);
            content.appendChild(message);
            overlay.appendChild(content);
            
            gameBoard.appendChild(overlay);
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', handleKeyDown);
            
            // æŒ‰é’®äº‹ä»¶
            startBtn.addEventListener('click', startGame);
            pauseBtn.addEventListener('click', togglePause);
            restartBtn.addEventListener('click', restartGame);
            
            // éŸ³æ•ˆåˆ‡æ¢
            soundToggle.addEventListener('click', toggleSound);
            
            // ç§»åŠ¨ç«¯æ§åˆ¶
            mobileControls.forEach(btn => {
                btn.addEventListener('touchstart', handleMobileControl);
                btn.addEventListener('mousedown', handleMobileControl);
            });
        }

        // å¤„ç†é”®ç›˜è¾“å…¥
        function handleKeyDown(event) {
            if (currentState !== gameState.PLAYING && currentState !== gameState.PAUSED) return;
            
            switch(event.key) {
                case 'ArrowUp':
                    if (currentDirection !== directions.DOWN) {
                        nextDirection = directions.UP;
                    }
                    break;
                case 'ArrowDown':
                    if (currentDirection !== directions.UP) {
                        nextDirection = directions.DOWN;
                    }
                    break;
                case 'ArrowLeft':
                    if (currentDirection !== directions.RIGHT) {
                        nextDirection = directions.LEFT;
                    }
                    break;
                case 'ArrowRight':
                    if (currentDirection !== directions.LEFT) {
                        nextDirection = directions.RIGHT;
                    }
                    break;
                case 'p':
                case 'P':
                    togglePause();
                    break;
            }
            
            // é˜²æ­¢æ–¹å‘é”®æ»šåŠ¨é¡µé¢
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
                event.preventDefault();
            }
        }

        // å¤„ç†ç§»åŠ¨ç«¯æ§åˆ¶
        function handleMobileControl(event) {
            event.preventDefault();
            if (currentState !== gameState.PLAYING && currentState !== gameState.PAUSED) return;
            
            const direction = event.target.classList[1];
            
            switch(direction) {
                case 'up':
                    if (currentDirection !== directions.DOWN) {
                        nextDirection = directions.UP;
                    }
                    break;
                case 'down':
                    if (currentDirection !== directions.UP) {
                        nextDirection = directions.DOWN;
                    }
                    break;
                case 'left':
                    if (currentDirection !== directions.RIGHT) {
                        nextDirection = directions.LEFT;
                    }
                    break;
                case 'right':
                    if (currentDirection !== directions.LEFT) {
                        nextDirection = directions.RIGHT;
                    }
                    break;
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (currentState === gameState.READY || currentState === gameState.GAME_OVER) {
                currentState = gameState.PLAYING;
                score = 0;
                initSnake();
                generateFood();
                updateUI();
                
                // å¼€å§‹æ¸¸æˆå¾ªç¯
                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, config.gameSpeed);
            }
        }

        // åˆ‡æ¢æš‚åœçŠ¶æ€
        function togglePause() {
            if (currentState === gameState.PLAYING) {
                currentState = gameState.PAUSED;
                clearInterval(gameInterval);
            } else if (currentState === gameState.PAUSED) {
                currentState = gameState.PLAYING;
                gameInterval = setInterval(gameLoop, config.gameSpeed);
            }
            
            updateButtonStates();
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            clearInterval(gameInterval);
            currentState = gameState.READY;
            score = 0;
            initSnake();
            generateFood();
            updateUI();
        }

        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSound() {
            soundEnabled = !soundEnabled;
            updateSoundToggle();
            saveSettings();
        }

        // æ›´æ–°éŸ³æ•ˆåˆ‡æ¢æŒ‰é’®
        function updateSoundToggle() {
            const soundIcon = soundToggle.querySelector('.sound-icon');
            soundIcon.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (currentState !== gameState.PLAYING) return;
            
            // æ›´æ–°æ–¹å‘
            currentDirection = nextDirection;
            
            // ç§»åŠ¨è›‡
            moveSnake();
            
            // æ£€æŸ¥ç¢°æ’
            if (checkCollisions()) {
                gameOver();
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (checkFoodCollision()) {
                eatFood();
            }
            
            // æ›´æ–°UI
            updateUI();
        }

        // ç§»åŠ¨è›‡
        function moveSnake() {
            // åˆ›å»ºæ–°çš„è›‡å¤´
            const head = { ...snake[0] };
            head.x += currentDirection.x;
            head.y += currentDirection.y;
            
            // å°†æ–°å¤´æ·»åŠ åˆ°è›‡èº«å‰é¢
            snake.unshift(head);
            
            // ç§»é™¤è›‡å°¾ï¼ˆé™¤éåˆšåˆšåƒåˆ°é£Ÿç‰©ï¼‰
            // åœ¨eatFoodå‡½æ•°ä¸­å¤„ç†è›‡èº«å¢é•¿
            if (!checkFoodCollision()) {
                snake.pop();
            }
        }

        // æ£€æŸ¥ç¢°æ’
        function checkCollisions() {
            const head = snake[0];
            
            // æ£€æŸ¥å¢™å£ç¢°æ’
            if (
                head.x < 0 || 
                head.x >= config.gridSize || 
                head.y < 0 || 
                head.y >= config.gridSize
            ) {
                return true;
            }
            
            // æ£€æŸ¥è‡ªèº«ç¢°æ’ï¼ˆä»ç¬¬äºŒä¸ªèº«ä½“éƒ¨åˆ†å¼€å§‹æ£€æŸ¥ï¼‰
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            
            return false;
        }

        // æ£€æŸ¥é£Ÿç‰©ç¢°æ’
        function checkFoodCollision() {
            const head = snake[0];
            return head.x === food.x && head.y === food.y;
        }

        // åƒåˆ°é£Ÿç‰©
        function eatFood() {
            // å¢åŠ åˆ†æ•°
            score += config.foodPoints;
            
            // æ’­æ”¾éŸ³æ•ˆ
            if (soundEnabled) {
                playSound('eat');
            }
            
            // ç”Ÿæˆæ–°é£Ÿç‰©
            generateFood();
            
            // æ£€æŸ¥æ˜¯å¦åˆ·æ–°æœ€é«˜åˆ†
            if (score > highScore) {
                highScore = score;
                saveSettings();
            }
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            currentState = gameState.GAME_OVER;
            clearInterval(gameInterval);
            
            // æ’­æ”¾ç¢°æ’éŸ³æ•ˆ
            if (soundEnabled) {
                playSound('crash');
            }
            
            // æ·»åŠ å±å¹•éœ‡åŠ¨æ•ˆæœ
            gameBoard.style.animation = 'shake 0.5s';
            setTimeout(() => {
                gameBoard.style.animation = '';
            }, 500);
            
            updateUI();
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(soundName) {
            if (sounds[soundName]) {
                sounds[soundName].currentTime = 0;
                sounds[soundName].play().catch(e => {
                    // å¿½ç•¥è‡ªåŠ¨æ’­æ”¾ç­–ç•¥é”™è¯¯
                });
            }
        }

        // æ·»åŠ å±å¹•éœ‡åŠ¨åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0% { transform: translate(1px, 1px) rotate(0deg); }
                10% { transform: translate(-1px, -2px) rotate(-1deg); }
                20% { transform: translate(-3px, 0px) rotate(1deg); }
                30% { transform: translate(3px, 2px) rotate(0deg); }
                40% { transform: translate(1px, -1px) rotate(1deg); }
                50% { transform: translate(-1px, 2px) rotate(-1deg); }
                60% { transform: translate(-3px, 1px) rotate(0deg); }
                70% { transform: translate(3px, 1px) rotate(-1deg); }
                80% { transform: translate(-1px, -1px) rotate(1deg); }
                90% { transform: translate(1px, 2px) rotate(0deg); }
                100% { transform: translate(1px, -2px) rotate(-1deg); }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>
